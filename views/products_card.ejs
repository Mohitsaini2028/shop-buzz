

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>



<link rel="stylesheet" href="/css/card.css" />


<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/css/star-rating.min.css" media="all" rel="stylesheet" type="text/css" />

<!-- with v4.1.0 Krajee SVG theme is used as default (and must be loaded as below) - include any of the other theme CSS files as mentioned below (and change the theme property of the plugin) -->
<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/themes/krajee-svg/theme.css" media="all" rel="stylesheet" type="text/css" />

<!-- important mandatory libraries -->
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/js/star-rating.min.js" type="text/javascript"></script>

<!-- with v4.1.0 Krajee SVG theme is used as default (and must be loaded as below) - include any of the other theme JS files as mentioned below (and change the theme property of the plugin) -->
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/themes/krajee-svg/theme.js"></script>





<div class="container mt-5">

    <div class="row">

    <% if (products && products.length>0) { %>

        <% products.forEach(function(p){ %>    

                <% if (p.discountedPrice<100000000 &&  p.discountedPrice>-1) { %>  
                <div class="col-md-4">      
                
                <div class="card mr-2">
                    
                    <div class="image-container">
                        
                        <div class="first">
                            
                            <div class="d-flex justify-content-between align-items-center">
                                
                                <span class="discount"> <%= (100 * (Number(p.originalPrice) - Number(p.discountedPrice))/Number(p.originalPrice)).toFixed(0) %> %</span>
                                <!-- <span class="wishlist"><i class="fa fa-heart-o"></i></span> -->                            
                                
                            </div>
                        </div>

                        <a href="/products/<%= p.category %>/<%= p.slug %>"><img src="/product_images/<%= p.id %>/<%= p.image %>"  width="80%" style="max-height:160px;" class="img-fluid align-items p-2 rounded thumbnail-image">
                    </a>
                    </div>
                    
                    
                    <div class="product-detail-container p-2">
                        
                        <div class="d-flex justify-content-between">
                            
                            <a href="/products/<%= p.category %>/<%= p.slug %>"><h5 class="dress-name"><%= p.title.slice(0, 25) %> </h5></a>

                            <div class="d-flex flex-column mb-2">
                                
                                <span class="new-price pl-4">$<%= parseFloat(p.discountedPrice).toFixed(2) %></span>
                                <small class="old-price text-right">$<%= parseFloat(p.originalPrice).toFixed(2) %></small>
                            </div>
                            
                        </div>
                        
                            <!-- <div class="d-flex justify-content-between align-items-center pt-1"> -->
                                
                                <!-- <div class="color-select d-flex ">
                                    
                                    <input type="button" name="grey" class="btn creme">
                                    <input type="button" name="red" class="btn red ml-2">
                                    <input type="button" name="blue" class="btn blue ml-2">
                                    
                                </div> -->

                                <div class="flex">
                                    <p><%= p._id %></p>
                                    <input id="star-rating-<%= p._id %>" type="text" class="rating" data-size="xs" >
                                </div>   
                                <!-- <div class="">
                                    
                                    <span class="item-size mr-2 btn" type="button">S</span>
                                    <span class="item-size mr-2 btn" type="button">M</span>
                                    <span class="item-size btn" type="button">L</span>

                                </div>-->
                                
                            <!-- </div>  -->
                            
                            <div class="d-flex justify-content-between align-items-center pt-1">
                                <div>
                                    <!-- <i class="fa fa-star-o rating-star"></i> -->
                                    <span class="rating-number">3.8</span>
                                </div>
                                
                                <span class="buy"><a class="bg-dark text-decoration-none text-warning p-2 rounded" href="/cart/add/<%= p.slug %>">Add to cart 
                                    <!-- <i class="fa-solid fa-cart-arrow-down"></i> -->
                                </a></span>
                                
                                

                            </div>                       

                        </div>
                    
                    </div>
                    
                    
                <div class="mt-3">
                    <div class="card voutchers">
                        
                        <div class="voutcher-divider">
                            <div class="voutcher-left text-center">
                                <span class="voutcher-name"><%= p.category.toUpperCase() %></span>
                                <h5 class="voutcher-code">#<%= p.subCategory %></h5>
                                
                            </div>
                            <div class="voutcher-right text-center border-left">
                                <h5 class="discount-percent"> <%= (100 * (Number(p.originalPrice) - Number(p.discountedPrice))/Number(p.originalPrice)).toFixed(0) %>%</h5>
                                <span class="off">Off</span>
                                
                            </div>          
                        </div>
                        
                    </div>
                    
                </div>
            
        </div>
        <% } %>
        <% }); %>

    <%} else {%>
        <h4 class="ml-5">Sorry no product to display</h4>     
    <% }; %>
    </div>

</div>

</div>

</div>

</div>



<script>

// Rating Portion

$("#star-rating").rating();

// with plugin options (do not attach the CSS class "rating" to your input if using this approach)
$("#star-rating").rating({'size':'lg'});
console.log(("star-rating").val());

$("#input1, #input2").click(function() {
    $(this).closest("form").attr("action", actions[this.id]);
});
   
    $('#filter_form').submit(function (e) {
    
    let slug = '<%-title%>'
    let max = document.getElementById('max').value;
    let min = document.getElementById('min').value;

    let searchTerm = '';
    
    
    if(slug=='All products'){
        console.log("submit ji", max, min);
        // $('#filter_form').action = `/products?max=${max}&?min=${min}`;
        $('#filter_form').attr('action', '/products?max=45&?min=33');
        
        $('#filter_form').submit();
        
    }
    else if(slug=='cat_products'){
        console.log("submit catx", max, min);
        $('#filter_form').action = `/products/?max=${max}?min=${min}`;

    }
    else if(slug=='Search Result'){
        $('#filter_form').action = `/search${searchTerm}?max=${max}?min=${min}`;
    }
    console.log("submit no",slug, typeof slug=='All products');

    // window.history.back();
});


</script>    
            
<%- include('_layouts/footer.ejs'); %>

